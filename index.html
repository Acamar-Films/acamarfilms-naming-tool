<!DOCTYPE html>
<html>
<head>
  <title>Acamar Films Naming Convention Generator</title>
  <style>
    body { font-family: Arial; max-width: 1000px; margin: 30px auto; padding: 20px; }
    select, input, textarea, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0 16px;
      font-size: 14px;
    }
    textarea { height: 200px; }
    .tool { display: none; }
    #output { white-space: pre; background: #f3f3f3; border: 1px solid #ccc; padding: 15px; }
    .row { display: flex; gap: 10px; }
    .row button { width: auto; flex: 1; }
  </style>
</head>
<body>

<h1>Acamar Films Naming Convention Generator</h1>

<!-- Tool Selector -->
<label>Choose Tool</label>
<select id="toolSelect" onchange="showTool()">
  <option value="">-- Select --</option>
  <option value="stems">Audio Stems</option>
</select>

<!-- Episode Manager -->
<h2>Episode List</h2>
<textarea id="episodeEditor"
placeholder="EP01|Pilot
EP02|The First Test
EP03|Unexpected Results"></textarea>

<div class="row">
  <button onclick="saveEpisodes()">Save Episodes</button>
  <button onclick="loadEpisodes()">Load Episodes</button>
</div>

<hr>

<!-- Audio Stems -->
<div id="stems" class="tool">
  <h3>Audio Stems (Batch Enabled)</h3>

  <label>Territory</label>
  <input id="stm_terr" placeholder="US">

  <label>Episode</label>
  <select id="stm_episode"></select>

  <label>Format (Stereo / 5.1)</label>
  <input id="stm_fmt" placeholder="5.1">

  <label>Stem Types (comma separated)</label>
  <input id="stm_types" placeholder="FMX, DX, ME">

  <button onclick="genStems()">Generate</button>
</div>

<h3>Output</h3>
<div id="output"></div>

<div class="row">
  <button onclick="copyOutput()">Copy to Clipboard</button>
  <button onclick="downloadCSV()">Download CSV</button>
</div>

<script>
/* ---------------- EPISODES ---------------- */

let episodes = [];

function saveEpisodes() {
  const lines = episodeEditor.value.split("\n");
  episodes = lines.map(l => {
    const [num, name] = l.split("|");
    return { num: num?.trim(), name: name?.trim() };
  }).filter(e => e.num && e.name);

  localStorage.setItem("acamarEpisodes", JSON.stringify(episodes));
  populateEpisodeDropdown();
  alert("Episodes saved!");
}

function loadEpisodes() {
  const stored = localStorage.getItem("acamarEpisodes");
  if (!stored) return;

  episodes = JSON.parse(stored);
  episodeEditor.value = episodes.map(e => `${e.num}|${e.name}`).join("\n");
  populateEpisodeDropdown();
}

function populateEpisodeDropdown() {
  const sel = document.getElementById("stm_episode");
  sel.innerHTML = "";
  episodes.forEach(e => {
    const opt = document.createElement("option");
    opt.value = `${e.num}_${e.name}`;
    opt.textContent = `${e.num} â€“ ${e.name}`;
    sel.appendChild(opt);
  });
}

/* ---------------- TOOLS ---------------- */

function showTool() {
  document.querySelectorAll('.tool').forEach(t => t.style.display = "none");
  const id = toolSelect.value;
  if (id) document.getElementById(id).style.display = "block";
  output.textContent = "";
}

/* ---------------- GENERATORS ---------------- */

let lastOutput = [];

function genStems() {
  const types = stm_types.value.split(",").map(t => t.trim());
  const ep = stm_episode.value;

  lastOutput = types.map(type =>
    `BNG_${stm_terr.value}_${ep}_${stm_fmt.value}_${type}`
  );

  output.textContent = lastOutput.join("\n");
}

/* ---------------- UTILITIES ---------------- */

function copyOutput() {
  navigator.clipboard.writeText(output.textContent);
  alert("Copied to clipboard!");
}

function downloadCSV() {
  if (!lastOutput.length) return;
  const csv = lastOutput.join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Acamar_Filenames.csv";
  a.click();
}

/* ---------------- INIT ---------------- */

window.onload = () => {
  loadEpisodes();
};
</script>

</body>
</html>
